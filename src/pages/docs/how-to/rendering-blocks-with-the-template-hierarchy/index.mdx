export const metadata = {
	title: "Rendering Blocks with the Template Hierarchy",
	description:
		"Learn how to use Faust.js template router to dynamically map and render WordPress blocks as React components.",
};

In headless WordPress with Faust.js, the template router offers a powerful way to dynamically map WordPress pages and posts to specific templates, streamlining how content is fetched and rendered. When working with WordPress block data, the template router allows you to efficiently map block types to React components, giving you greater control over how individual blocks are rendered within each template.

This guide walks you through rendering native WordPress core blocks using the template router.

## Steps

### 1\. Basic Setup

If you haven't already, follow the [Basic Setup](/docs/how-to/basic-setup/) to get Faust.js set up.

### 2\. Template Hierarchy Setup

Set up the [template hierarchy](/docs/how-to/template-hierarchy/) in Faust.js.

### 3\. WPGraphQL Content Blocks Plugin

1\. Set up the [WPGraphQL Content Blocks plugin](https://github.com/wpengine/wp-graphql-content-blocks) on the WP backend. Head over to the [GitHub repo](https://github.com/wpengine/wp-graphql-content-blocks) and download the [latest version](https://github.com/wpengine/wp-graphql-content-blocks/releases/latest/download/wp-graphql-content-blocks.zip) of the `wp-graphql-content-blocks` plugin from the releases tab.

2\. Upload the plugins `.zip` file to your WordPress site via the plugins page or unzip and copy the file contents into your WordPress `wp-content/plugins` folder manually.

3\. Activate the plugin on the WordPress plugins page.

### 4. Render Blocks from the @faust/blocks package

The `@faust/blocks` package contains a small reference list of blocks that you can use in your site. To use them, you need to import the relevant blocks into your block list:

```js title="wp-blocks/index.js"
// wp-blocks/index.js
import { CoreBlocks } from "@faustwp/blocks";

export default {
	CoreParagraph: CoreBlocks.CoreParagraph,
	CoreColumns: CoreBlocks.CoreColumns,
	CoreColumn: CoreBlocks.CoreColumn,
	CoreCode: CoreBlocks.CoreCode,
	CoreQuote: CoreBlocks.CoreQuote,
	CoreImage: CoreBlocks.CoreImage,
	CoreSeparator: CoreBlocks.CoreSeparator,
	CoreList: CoreBlocks.CoreList,
	CoreButton: CoreBlocks.CoreButton,
	CoreButtons: CoreBlocks.CoreButtons,
	CoreHeading: CoreBlocks.CoreHeading,
};
```

You can add the code block above to your `wp-blocks/index.js` file.

Then in your template query, you need to pass the provided fragment entries:

```js title=" wp-templates/front-page.js"
import blocks from "../wp-blocks";

Component.query = gql`
  ${blocks.CoreParagraph.fragments.entry}
  ${blocks.CoreColumns.fragments.entry}
  ${blocks.CoreColumn.fragments.entry}
  ${blocks.CoreCode.fragments.entry}
  ${blocks.CoreButtons.fragments.entry}
  ${blocks.CoreButton.fragments.entry}
  ${blocks.CoreQuote.fragments.entry}
  ${blocks.CoreImage.fragments.entry}
  ${blocks.CoreSeparator.fragments.entry}
  ${blocks.CoreList.fragments.entry}
  ${blocks.CoreHeading.fragments.entry}
  query GetPage(
    $databaseId: ID!
    $asPreview: Boolean = false
  ) {
    page(id: $databaseId, idType: DATABASE_ID, asPreview: $asPreview) {
      title
      content
      editorBlocks {
        name
        __typename
        renderedHtml
        id: clientId
        parentId: parentClientId
        ...${blocks.CoreParagraph.fragments.key}
        ...${blocks.CoreColumns.fragments.key}
        ...${blocks.CoreColumn.fragments.key}
        ...${blocks.CoreCode.fragments.key}
        ...${blocks.CoreButtons.fragments.key}
        ...${blocks.CoreButton.fragments.key}
        ...${blocks.CoreQuote.fragments.key}
        ...${blocks.CoreImage.fragments.key}
        ...${blocks.CoreSeparator.fragments.key}
        ...${blocks.CoreList.fragments.key}
        ...${blocks.CoreHeading.fragments.key}
      }
    }
  }
`;
```

Now that you have all the queries ready, you can render the blocks using the provided `flatListToHierarchical` method and `WordPressBlocksViewer`:

```js title="wp-templates/front-page.js"


import { gql } from '@apollo/client';
import { flatListToHierarchical } from '@faustwp/core';
import { WordPressBlocksViewer } from '@faustwp/blocks';
import blocks from '../wp-blocks';

export default function Component({ loading, data }) {
  // Loading state for previews.
  if (loading) {
    return <>Loading...</>;
  }

  const { title, editorBlocks } = data?.page ?? { title: '' };
  const blockList = flatListToHierarchical(editorBlocks, { childrenKey: 'innerBlocks' });

  return (
    <div className='is-layout-constrained'>
      <h1>{title}</h1>
      <WordPressBlocksViewer blocks={blockList} />
    </div>
  );
}
...
```

### WordPressBlocksProvider- Theme Use

If you do not need a theme, you must pass `null` as the `theme` prop for the `WordPressBlocksProvider` like the example below. If you donâ€™t pass a theme, it will fail.

```js
<WordPressBlocksProvider config={{ blocks, theme: null }}>
```
