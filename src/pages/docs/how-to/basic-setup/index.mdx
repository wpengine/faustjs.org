export const metadata = {
	title: "Basic Setup",
	description:
		"Step-by-step guide for setting up a WordPress backend and Next.js frontend to use Faust.js toolkit features.",
};

In order to leverage any of the tools in the Faust.js toolkit, some preliminary setup needs to be done. Follow the steps below to get started.

## Steps

### Set up a WordPress backend and a Next.js frontend

If you don't have one up and running already, create a new WordPress site. This can be a site running [on your local machine](https://localwp.com/), or one hosted on the web somewhere.

Likewise, if you don't have a Next.js project yet, [create one](https://nextjs.org/docs/getting-started/installation) on your local computer.

### Activate plugins

Install and activate the [FaustWP](https://wordpress.org/plugins/faustwp/) and [WPGraphQL](https://wordpress.org/plugins/wp-graphql/) plugins on your WordPress backend site.

### Set permalinks

In the WordPress admin sidebar, go to `Settings` > `Permalinks`. Check the radio button next to `Custom Structure`, type `/blog/%postname%/` into the box next to it, then click the button to save your changes. This will result in Posts having URIs like `/blog/hello-world`, whereas Pages will still exist on the root domain, such as `/about`.

### Set environment variables

Create a `.env.local` file in the root of your Next.js project that contains these environment variables:

```ini title=".env.local"
# Your WordPress site URL
NEXT_PUBLIC_WORDPRESS_URL=https://faustexample.wpengine.com // [!code ++]

# Plugin secret found in WordPress Settings->Faust
FAUST_SECRET_KEY=YOUR_PLUGIN_SECRET // [!code ++]
```

Replace `https://faustexample.wpengine.com` with the URL for your WordPress backend.

Replace `YOUR_PLUGIN_SECRET` with the Secret Key found in `Settings → Faust` in your WordPress admin area.

![Faust.js secret key](./images/headless-admin-secret-1024x743.png)

Save your `.env.local` file.

## Install dependencies

Install the `@apollo/client`, gql and `@faustwp/core` NPM packages in your Next.js app.

```bash
npm install @apollo/client @faustwp/core graphql @faustwp/cli
```

## Create Faust config file

Create a `faust.config.js` file in the root of your project with this code:

```js title="faust.config.js"
import { setConfig } from "@faustwp/core";

/**
 * @type {import('@faustwp/core').FaustConfig}
 **/
export default setConfig({});
```

### Create Faust API route

Create an API route for Faust.js to use. You can do this by creating a file in `src/pages/api/faust/[[...route]].js`, with the following code:

```js title="src/pages/api/faust/[[...route]].js"
import "../../faust.config"; // Adjust path as necessary

export { apiRouter as default } from "@faustwp/core";
```

> [!IMPORTANT] Important
> If you're not using a `/src` folder in your project, you can omit "/src" from the file path above. And the same applies for other file paths mentioned throughout this doc.

### Update `_app.js` file

Once the API router is set up, head to `src/pages/_app.js`. Add the `import` statements, wrap your app in the `FaustProvider`, and pass `key={router.asPath}` to `Component`, as shown below.

```js title="src/pages/_app.js"
import { useRouter } from "next/router";
import { FaustProvider } from "@faustwp/core";
import "../faust.config";

export default function App({ Component, pageProps }) {
	const router = useRouter();

	return (
		<FaustProvider pageProps={pageProps}>
			<Component {...pageProps} key={router.asPath} />
		</FaustProvider>
	);
}
```

## Set up the Template Hierarchy

### Generate types

In order for Faust.js to run the GraphQL queries it needs to determine the correct template to use, it needs to have a list of all the types available in the GraphQL schema. We'll generate this list of types now.

In your WordPress admin sidebar, go to `GraphQL` > `Settings`. Check the `Enable Public Introspection` box if it's not checked already and save your changes. Enabling introspection is required for the `npm run generate` command below to work.

Add the following generate script to your Next.js project's `package.json` file, in the scripts block:

```json title="package.json"
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "generate": "faust generatePossibleTypes", // [!code ++]
    "start": "next start",
    "lint": "next lint"
  },
```

Run `npm run generate` on the command line. Confirm that a possibleTypes.json has been generated in the root of your project.

### Add a template

Create a new `src/wp-templates` folder (or add the `/wp-templates` folder in the root project folder if you don't use a `/src` folder). This is where your template files will be stored. We'll start by adding a template for rendering single blog posts.

Inside the `wp-templates` folder, create a `single.js` file that contains the following code.

```js title="wp-templates/single.js"
import { gql } from "@apollo/client";

export default function SingleTemplate(props) {
	const { title, content } = props.data.post;

	return (
		<>
			<h1>{title}</h1>
			<div dangerouslySetInnerHTML={{ __html: content }} />
		</>
	);
}

SingleTemplate.query = gql`
	query GetPost($uri: ID!) {
		post(id: $uri, idType: URI) {
			title
			content
		}
	}
`;

SingleTemplate.variables = (seedQuery, ctx) => {
	return {
		uri: seedQuery?.uri,
	};
};
```

Inside of the `SingleTemplate.variables` function, we pass in the URI of the current page so that it's available for GraphQL queries to use.

Inside the `SingleTemplate.query` tagged template literal, we pass the `uri` for the current page into the GraphQL query, telling WordPress that we want to fetch the `title` and `content` for the post matching that URI.

In the `SingleTemplate` component, we receive the props, destructure the `title` and `content`, then return some JSX to render the title and content to the page.

Finally, we have to make Faust.js aware that this template exists. To do that, create an `index.js` file inside the `wp-templates` folder with this code inside:

```js title="wp-templates/index.js"
import SingleTemplate from "./single";

const templates = {
	single: SingleTemplate,
};

export default templates;
```

### Pass in Templates and Types in Faust.js config

Put the following code inside your `faust.config.js` file:

```js title="faust.config.js"
import { setConfig } from "@faustwp/core";
import templates from "./src/wp-templates/index.js"; // Adjust path as necessary // [!code ++]
import possibleTypes from "./possibleTypes.json"; // [!code ++]

/**
 * @type {import('@faustwp/core').FaustConfig}
 **/
export default setConfig({
	templates, // [!code ++]
	possibleTypes, // [!code ++]
});
```

Here, we call the `setConfig()` function that Faust.js provides, passing in our `templates` and `possibleTypes` to it.

### Create a catch-all route

Create a `[...wordpressNode].js` file inside your `pages` folder. Add the following code to it.

```js title="src/pages/[...wordpressNode].js"
import { getWordPressProps, WordPressTemplate } from "@faustwp/core";

export default function Page(props) {
	return <WordPressTemplate {...props} />;
}

export function getStaticProps(ctx) {
	return getWordPressProps({ ctx });
}

export async function getStaticPaths() {
	return {
		paths: [],
		fallback: "blocking",
	};
}
```

This catch-all route tells Next.js to use the templates to render pages.

Note that it is still possible to override this with hardcoded pages. For example, if you have a page in your WordPress site with a URI of `/about`, Faust.js will render that page using the relevant template in your project's `wp-templates` folder. However, if you add a `src/pages/about.js` file to your project, Next.js will render the `/about` path in your app using that file instead.

## Test your template

You should now be able to make use of this template.

Run `npm run dev` to get your Next.js project running in development mode, then visit the URL for one of the blog posts– something like `http://localhost:3000/blog/hello-world/`.

If you've wired everything up correctly, the page should render and display the post's title and content.

### Next steps

You are now ready to leverage Faust's other features, including:

- [Authentication](/docs/how-to/authentication/)

- [Post Previews](/docs/how-to/post-previews/)

- [Render Blocks](/docs/how-to/rendering-blocks/)
